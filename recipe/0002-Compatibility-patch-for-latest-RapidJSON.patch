From 3e4f6a25b1d0eaa8272d41566cbd2b941266f6c6 Mon Sep 17 00:00:00 2001
From: Hyunsu Cho <phcho@nvidia.com>
Date: Fri, 24 May 2024 15:25:18 -0700
Subject: [PATCH] Compatibility patch for latest RapidJSON

---
 cmake/ExternalLibs.cmake | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/cmake/ExternalLibs.cmake b/cmake/ExternalLibs.cmake
index b014982..dc695df 100644
--- a/cmake/ExternalLibs.cmake
+++ b/cmake/ExternalLibs.cmake
@@ -5,7 +5,15 @@ add_library(rapidjson INTERFACE)
 target_compile_definitions(rapidjson INTERFACE -DRAPIDJSON_HAS_STDSTRING=1)
 find_package(RapidJSON)
 if(RapidJSON_FOUND)
-  target_include_directories(rapidjson INTERFACE ${RAPIDJSON_INCLUDE_DIRS})
+  if(DEFINED RAPIDJSON_INCLUDE_DIRS)
+    # Compatibility with 1.1.0 stable (circa 2016)
+    set(RapidJSON_include_dir "${RAPIDJSON_INCLUDE_DIRS}")
+  else()
+    # Latest RapidJSON (1.1.0.post*)
+    set(RapidJSON_include_dir "${RapidJSON_INCLUDE_DIRS}")
+  endif()
+  target_include_directories(rapidjson INTERFACE ${RapidJSON_include_dir})
+  message(STATUS "Found RapidJSON: ${RapidJSON_include_dir}")
 else()
   message(STATUS "Did not find RapidJSON in the system root. Fetching RapidJSON now...")
   FetchContent_Declare(
-- 
2.43.0

